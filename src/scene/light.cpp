#include "light.h"
#include "collision.h"
#include "renderer.h"
#include "LightProps.h"


//=====================================================================================================================================
// Init [point_light_t]                                                                                                               =
//=====================================================================================================================================
void point_light_t::Init( const char* filename )
{
	light_props = rsrc::light_props.load( filename );
	radius = light_props->getRadius();
}


//=====================================================================================================================================
// Init [spot_light_t]                                                                                                                =
//=====================================================================================================================================
void spot_light_t::Init( const char* filename )
{
	light_props = rsrc::light_props.load( filename );
	camera.SetAll( light_props->getFovX(), light_props->getFovY(), 0.2, light_props->getDistance() );
	castsShadow = light_props->castsShadow();
	if( light_props->getTexture() == NULL )
	{
		ERROR( "Light properties \"" << light_props->getName() << "\" do not have a texture" );
		return;
	}
}


//=====================================================================================================================================
// Deinit                                                                                                                             =
//=====================================================================================================================================
void light_t::Deinit()
{
	rsrc::light_props.unload( light_props );
}


//=====================================================================================================================================
// RenderSphere                                                                                                                       =
//=====================================================================================================================================
static void RenderSphere( const mat4_t& tsl, const vec3_t& col )
{
	glPushMatrix();
	r::MultMatrix( tsl );

	r::Color3( col );
	r::dbg::RenderSphere( 1.0/8.0, 8 );

	glPopMatrix();
}


//=====================================================================================================================================
// Render                                                                                                                             =
//=====================================================================================================================================
void point_light_t::Render()
{
	RenderSphere( transformation_wspace, light_props->getDiffuseColor() );
}


//=====================================================================================================================================
// Render                                                                                                                             =
//=====================================================================================================================================
void spot_light_t::Render()
{
	RenderSphere( transformation_wspace, light_props->getDiffuseColor() );
}
